{% extends "base.html" %}

{% block title %}Create Contract - LawBot 360{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2>Create Contract</h2>
        <p class="text-muted">Generate a contract from natural language or structured inputs</p>
    </div>
</div>

<div class="row mt-4">
    <div class="col-lg-8">
        <form id="contractForm">
            <div class="card shadow">
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Contract Type</label>
                        <select class="form-select" id="contractType" required>
                            <option value="">Select type...</option>
                            <option value="NDA">Non-Disclosure Agreement (NDA)</option>
                            <option value="Employment">Employment Agreement</option>
                            <option value="Service">Service Agreement</option>
                            <option value="Consultant">Consultant Agreement</option>
                            <option value="Lease">Lease Agreement</option>
                            <option value="Partnership">Partnership Agreement</option>
                            <option value="Vendor">Vendor Agreement</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Parties</label>
                        <input type="text" class="form-control" id="parties" placeholder="Party A, Party B" required>
                        <small class="form-text text-muted">Comma-separated list of parties</small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Natural Language Description</label>
                        <textarea class="form-control" id="description" rows="4" placeholder="E.g., Employment agreement for Software Engineer at 8 LPA, 2-month notice period, includes NDA and IP clauses"></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Jurisdiction</label>
                            <select class="form-select" id="jurisdiction">
                                <option value="IN">India</option>
                                <option value="US">United States</option>
                                <option value="UK">United Kingdom</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Language</label>
                            <select class="form-select" id="language">
                                <option value="en">English</option>
                                <option value="hi">हिंदी</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Payment Terms</label>
                        <input type="text" class="form-control" id="payment" placeholder="E.g., ₹50,000 per month">
                    </div>

                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeNDA" checked>
                            <label class="form-check-label" for="includeNDA">Include NDA Clause</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeIP">
                            <label class="form-check-label" for="includeIP">Include IP Assignment Clause</label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg">Generate Contract</button>
                </div>
            </div>
        </form>
    </div>

    <div class="col-lg-4">
        <div class="card shadow">
            <div class="card-body">
                <h5>Preview</h5>
                <div id="preview" class="mt-3">
                    <p class="text-muted">Fill the form and click "Generate Contract" to see preview</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="resultSection" class="row mt-4" style="display: none;">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-body">
                <h4>Generated Contract</h4>
                <div id="contractResult"></div>
                <div class="mt-3">
                    <a id="downloadPdf" href="#" class="btn btn-outline-primary">Download PDF</a>
                    <a id="downloadDocx" href="#" class="btn btn-outline-primary">Download DOCX</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.getElementById('contractForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = {
        contract_type: document.getElementById('contractType').value,
        parties: document.getElementById('parties').value.split(',').map(p => p.trim()),
        terms: {
            payment: document.getElementById('payment').value,
            nda: document.getElementById('includeNDA').checked,
            ip: document.getElementById('includeIP').checked
        },
        jurisdiction: document.getElementById('jurisdiction').value,
        language: document.getElementById('language').value
    };
    
    try {
        const response = await fetch('/api/contracts/generate', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        
        if (response.ok) {
            document.getElementById('contractResult').innerHTML = result.html || '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            document.getElementById('resultSection').style.display = 'block';
            if (result.pdf_url) {
                document.getElementById('downloadPdf').href = result.pdf_url;
            }
            if (result.docx_url) {
                document.getElementById('downloadDocx').href = result.docx_url;
            }
        } else {
            alert('Error: ' + result.error);
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
});
</script>
{% endblock %}


